<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets">

<a4j:keepAlive beanName="generacionComprobanteController" />
<head>
<script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/validacion.js" />

<style type="text/css">
body, html {
	font-family: Monaco, Georgia, Times, serif;
	width: 100%;
	height: 100%;
}

#panelPrincipal {
	text-align: left;
}

#formGeneracionCertificado {
	width: 1000px;
	margin: 0 auto;
	color:
}

.datatable {
	padding-top: 10px;
}

.celda {
	width: 130px;
	color: #000;
}

.outputTitle {
	font-weight: bold;
	padding: 0px 10px !important;
}
</style>
</head>
<body>
	<rich:panel id="panelPrincipal" height="100%" reRender="lista">
		<f:facet name="header">
			<h:form id="formRefresh">
				<h:outputText value="Tesorería > Generar Certificado" />
				<a4j:commandLink action="#{generacionComprobanteController.inicio}" reRender="principal" style="text-decoration:none; margin-left:10px">
					<img src="#{facesContext.externalContext.requestContextPath}/imagenes/refresh.png" width="15" height="15" style="margin: 0; padding: 0" />
				</a4j:commandLink>
			</h:form>
		</f:facet>
		<center>
			<fieldset id="formGeneracionCertificado">
				<legend />
				<h:form>
					<div style="text-align: center;">
						<table style="margin: auto; width: 100%" border="0">
							<tr>
								<td colspan="6" style="text-align: left;"><h:outputText value="Compañia" styleClass="outputTitle" /></td>
							</tr>
							<tr>
								<td style="text-align: right; width: 12%;"><rich:message for="idUnidadNegocio" style="color: red;">
										<f:facet name="errorMarker">
											<h:graphicImage url="../imagenes/error.png" />
										</f:facet>
									</rich:message> <rich:spacer width="5" /> <h:outputText value="* Razón Social: " /></td>
								<td style="text-align: left; width: 20%;"><h:selectOneMenu id="idUnidadNegocio"
										value="#{generacionComprobanteController.idUnidadNegocio}" style=" width: 150px;" required="true" requiredMessage="">
										<f:selectItems value="#{generacionComprobanteController.comboListaUnidadNegocio}" />
									</h:selectOneMenu></td>
								<td>
									&nsp;
								</td>
								<td>
									&nsp;
								</td>
								<td>
									&nsp;
								</td>
								<td>
									&nsp;
								</td>
							</tr>
							<tr>
								<td colspan="6">
									<div style="width: 100%; border-top: 1px solid #C0C0C0; margin: 5px 0;"></div>
								</td>
							</tr>
							<tr>
								<td colspan="6" style="text-align: left;"><h:outputText value="Fecha de Emisión" styleClass="outputTitle" /></td>
							</tr>
							<tr>
								<td style="text-align: right; width: 12%;"><rich:message for="fecEmisionDesde" style="color: red;">
										<f:facet name="errorMarker">
											<h:graphicImage url="../imagenes/error.png" />

										</f:facet>
									</rich:message> <rich:spacer width="5" /> <h:outputText value="* Desde: " /></td>
								<td style="text-align: left; width: 20%;"><rich:calendar id="fecEmisionDesde" enableManualInput="false" showWeeksBar="false"
										datePattern="yyyy-MM-dd" value="#{generacionComprobanteController.fecEmisionDesde}" required="true" requiredMessage=""
										inputStyle="width: 125px;" /></td>
								<td style="text-align: right; width: 10%;"><rich:message for="fecEmisionHasta" style="color: red;">
										<f:facet name="errorMarker">
											<h:graphicImage url="../imagenes/error.png" />
										</f:facet>
									</rich:message> <rich:spacer width="5" /> <h:outputText value="* Hasta: " /></td>
								<td style="text-align: left; width: 20%;"><rich:calendar id="fecEmisionHasta" enableManualInput="false" showWeeksBar="false"
										datePattern="yyyy-MM-dd" value="#{generacionComprobanteController.fecEmisionHasta}" required="true" requiredMessage=""
										inputStyle="width: 125px;" /></td>
								<td>
									&nsp;
								</td>
								<td>
									&nsp;
								</td>
							</tr>
							<tr>
								<td style="text-align: right; width: 10%;"><!-- <h:outputText value="RUC: " /> --></td>
								<td style="text-align: left;"><!-- <h:inputText id="rucProveedor" value="#{generacionComprobanteController.rucProveedor}" /> --></td>
								<td colspan="3" />
								<td style="text-align: left;"><a4j:commandButton id="buscarComprobantes" style="margin:0 5px;" value="Buscar"
										action="#{generacionComprobanteController.buscar}" reRender="pnlLista, verDetalleComprobante, enviarComprobante" />
								</td>
							</tr>
							<!-- <tr>
								<td colspan="6">
									<div style="width: 100%; border-top: 1px solid #C0C0C0; margin: 5px 0;"></div>
								</td>
							</tr>
							<tr>
								<td colspan="6" style="text-align: left;"><h:outputText value="Código del Proveedor" styleClass="outputTitle" /></td>
							</tr>
							<tr>
								<td style="text-align: right; width: 10%;"><h:outputText value="Desde: " /></td>
								<td style="text-align: left;"><h:inputText id="codProveedorDesde" value="#{generacionComprobanteController.codProveedorDesde}" /></td>
								<td style="text-align: right; width: 10%;"><h:outputText value="Hasta: " /></td>
								<td style="text-align: left;"><h:inputText id="codProveedorHasta" value="#{generacionComprobanteController.codProveedorHasta}" /></td>
							</tr> -->
						
						</table>
					</div>
					<br />
					<rich:panel id="pnlLista">
						<div style="scrollbar-base-color: #3D8A3D; width: 1000px; border: 0px solid white; overflow-x: scroll;">
							<rich:extendedDataTable id="lista" var="itemComprobante" value="#{generacionComprobanteController.listaComprobantesElectronicos}" width="998px"
								height="280px" selection="#{generacionComprobanteController.selection}" selectionMode="single" reRender="true" keppSaved="false">
								<a4j:support action="#{generacionComprobanteController.seleccionarDetalleCertificadoRetencion}" event="onselectionchange"
									reRender="verDetalleComprobante" />

								<rich:column id="colEnFechaEmision" headerClass="dataTableHeader" width="14%" sortable="true" sortBy="#{itemComprobante.enFechaEmision}"
									sortIconAscending="dataTableAscIcon" sortIconDescending="dataTableDescIcon">
									<f:facet name="header">
										<h:outputText value="Fecha Emisión" />
									</f:facet>
									<center>
										<h:outputText value="#{itemComprobante.enFechaEmision}">
											<f:convertDateTime pattern="yyyy-MM-dd" />
										</h:outputText>
									</center>
								</rich:column>
								<rich:column id="colEnEmiNroDoc" headerClass="dataTableHeader" width="10%" sortable="true" sortBy="#{itemComprobante.enEmiNroDoc}"
									sortIconAscending="dataTableAscIcon" sortIconDescending="dataTableDescIcon">
									<f:facet name="header">
										<h:outputText value="RUC" />
									</f:facet>
									<center>
										<h:outputText value="#{itemComprobante.enProNroDocIdent}" />
									</center>
								</rich:column>
								<rich:column id="colEnEmiRazonSocial" headerClass="dataTableHeader" width="24%" sortable="true" sortBy="#{itemComprobante.enEmiRazonSocial}"
									sortIconAscending="dataTableAscIcon" sortIconDescending="dataTableDescIcon">
									<f:facet name="header">
										<h:outputText value="Razón Social" />
									</f:facet>
									<center>
										<h:outputText value="#{itemComprobante.enProRazonSocial}" />
									</center>
								</rich:column>
								<rich:column id="colEnNroComprobante" headerClass="dataTableHeader" width="14.5%" sortable="true" sortBy="#{itemComprobante.enNroComprobante}"
									sortIconAscending="dataTableAscIcon" sortIconDescending="dataTableDescIcon">
									<f:facet name="header">
										<h:outputText value="Nro. Certificado" />
									</f:facet>
									<center>
										<h:outputText value="#{itemComprobante.enNroComprobante}" />
									</center>
								</rich:column>
								<rich:column id="colEnRetPerMoneda" headerClass="dataTableHeader" width="13.5%" sortable="true" sortBy="#{itemComprobante.enRetPerMoneda}">
									<f:facet name="header">
										<h:outputText value="Moneda Pago" />
									</f:facet>
									<center>
										<h:outputText value="#{itemComprobante.enRetPerMoneda}" />
									</center>
								</rich:column>
								<rich:column id="colEnRetPerImporteRetenidoPercibido" headerClass="dataTableHeader" width="16%" sortable="true"
									sortBy="#{itemComprobante.enRetPerImporteRetenidoPercibido}">
									<f:facet name="header">
										<h:outputText value="Importe Retenido" />
									</f:facet>
									<center>
										<h:outputText value="#{itemComprobante.enRetPerImporteRetenidoPercibido}" style="float:right">
											<f:convertNumber locale="en_US" minFractionDigits="2" />
										</h:outputText>
									</center>
								</rich:column>
								<rich:column id="colSeleccionar" headerClass="dataTableHeader">
									<f:facet name="header">
										<h:outputText value="Seleccionar" />
									</f:facet>
									<center>
										<h:selectBooleanCheckbox id="selected" value="#{itemComprobante.seleccion}" immediate="true" />
									</center>
								</rich:column>
							</rich:extendedDataTable>
						</div>
						<br />
						<h:outputText id="numRegEncontrados" style="font-weight:bold;"
							value="N° de Registros Encontrados: #{null != generacionComprobanteController.listaComprobantesElectronicos ? generacionComprobanteController.listaComprobantesElectronicos.size() : 0}" />
					</rich:panel>

					<div align="right">
						<table border="0" cellpadding="0" cellspacing="0">
							<tr align="right">
								<td><a4j:commandButton id="verDetalleComprobante" action="#{generacionComprobanteController.cargarDetalleComprobante}"
										value="> Ver Detalle" style="margin-top: 10px;"
										oncomplete="#{null == facesContext.maximumSeverity ? 'Richfaces.showModalPanel(\'panelDetalleCertificadoRetencion\')' : ';'}"
										disabled="#{generacionComprobanteController.disabledBtnVerDetalle}" reRender="nroCertificadoComprobante,listaDetalle" render="true" /></td>
								<td><a4j:commandButton id="enviarComprobante" action="#{generacionComprobanteController.enviarComprobantesRetencion}"
										onclick="this.disabled=true;" value="> Enviar" style="margin-top: 10px;"
										oncomplete="#{null == facesContext.maximumSeverity ? 'Richfaces.showModalPanel(\'panelSuccess\');this.disabled=false' : 'this.disabled=false;'}"
										disabled="#{generacionComprobanteController.disabledBtnEnviar}" render="true"
										reRender="pnlLista, verDetalleComprobante, enviarComprobante, panelSuccess" /></td>
							</tr>
						</table>
					</div>
				</h:form>
			</fieldset>
		</center>
	</rich:panel>
</body>


<rich:modalPanel id="panelDetalleCertificadoRetencion" autosized="true">
	<f:facet name="controls">
		<h:panelGroup>
			<h:graphicImage id="hidelink" value="/imagenes/close.gif" styleClass="hidelink" />
			<rich:componentControl for="panelDetalleCertificadoRetencion" attachTo="hidelink" operation="hide" event="onclick" />
		</h:panelGroup>
	</f:facet>
	<h:form>
		<a4j:region>
			<a4j:include viewId="/paginas/tesoreria/comprobantes/generacionCertificadoRetencionDetalle.xhtml" />
		</a4j:region>
	</h:form>
</rich:modalPanel>

<rich:modalPanel id="panelSuccess" width="270" height="140">
	<f:facet name="header">
		<h:outputText value="Mensaje" />
	</f:facet>
	<h:panelGroup>
		<center>
			<h5>
				<h:outputText value="El proceso de envío se ha realizado correctamente!!" />
				<br />
				<br />
				<h:outputText id="nroCertificadosValidos" value="Nro. Documentos Enviados: #{generacionComprobanteController.nroCertificadosValidos}"
					style="margin: 15px 0px; text-decoration: underline; font-weight:bold;" />
				<br />
				<h:outputText id="nroCertificadosVencidos" value="Nro. Documentos Vencidos: #{generacionComprobanteController.nroCertificadosVencidos}"
					style="margin: 15px 0px; text-decoration: underline; font-weight:bold;" />
			</h5>
			<a4j:commandButton value="Aceptar" render="true"
				onclick="#{rich:component('panelSuccess')}.hide(); #{rich:component('panelPrincipal')}.hide(); return false"
				oncomplete="#{facesContext.maximumSeverity == null ? 'Richfaces.hideModalPanel(\'panelPrincipal\')' : ';'}" />
			<rich:componentControl for="panelPrincipal" attachTo="hidelink" operation="hide" event="onclick" />
		</center>
	</h:panelGroup>
</rich:modalPanel>
</html>