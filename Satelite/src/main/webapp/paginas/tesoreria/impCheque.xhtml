<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets">
<a4j:keepAlive beanName="impresionController" />
<head>
<style type="text/css">
body {
	font-size: 11px;
	color: #000;
	font-family: Arial, Verdana, sans-serif;
}

.extdt-menu-div-out, .extdt-menu-div-on {
	display: none !important;
}

td {
	vertical-align: top;
}

.rich-mpnl-header {
	padding-right: 30px;
}
</style>


<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="pragma" content="no-cache" />


<script type="text/javascript">

function validar(){

	var length=document.querySelectorAll('.rich-message-marker').length;
	console.info(length);
	return length==0;
}

</script>
</head>
<body>
	<rich:panel id="pnlImpresion">
		<f:facet name="header">
			<h:form id="frmActualizar">
				<h:outputText value="Tesorería > Impresión de Cheques">
				</h:outputText>
				<a4j:commandLink action="#{impresionController.inicio}" reRender="principal" style="text-decoration:none; margin-left:10px">
					<img src="#{facesContext.externalContext.requestContextPath}/imagenes/refresh.png" width="15" height="15" style="margin: 0; padding: 0" />
				</a4j:commandLink>
			</h:form>
		</f:facet>
		<h:form id="frmImpresion">

			<fieldset style="margin-bottom: 20px; padding: 20px;">
				<legend>Listado de cheques</legend>

				<h:panelGrid cellspacing="5" columns="3">
					<h:outputLabel value="Estado: "></h:outputLabel>
					<h:selectOneMenu id="selectEstado" value="#{impresionController.estado}" style="width:142px">
						<f:selectItems value="#{impresionController.estados}" />
					</h:selectOneMenu>
					<a4j:commandButton value="Buscar" action="#{impresionController.buscarCheques}" reRender="tblCheques"></a4j:commandButton>
				</h:panelGrid>
				<div align="center" style="scrollbar-base-color: #3d8a3d; width: 1080px; border: 0px solid white; overflow-x: scroll">
					<rich:extendedDataTable id="tblCheques" var="cheque" value="#{impresionController.cheques}" width="1420px" height="335px" rows="200"
						sortMode="single" selectionMode="none">
						<rich:column id="colNumero" headerClass="dataTableHeader" width="80" sortable="true" sortBy="#{cheque.numero}">
							<f:facet name="header">
								<h:outputText value="Número" />
							</f:facet>
							<center>
								<h:outputText value="#{cheque.numero}" />
							</center>
						</rich:column>
						<rich:column id="colBanco" headerClass="dataTableHeader" width="90" sortable="true" sortBy="#{cheque.banco}">
							<f:facet name="header">
								<h:outputText value="Banco" />
							</f:facet>
							<center>
								<h:outputText value="#{cheque.banco}" />
							</center>
						</rich:column>
						<rich:column id="colTipMoneda" headerClass="dataTableHeader" width="70" sortable="true" sortBy="#{cheque.tipoMoneda}">
							<f:facet name="header">
								<h:outputText value="Moneda" />
							</f:facet>
							<center>
								<h:outputText value="#{cheque.tipoMoneda}" />
							</center>
						</rich:column>
						<rich:column id="colBeneficiario" headerClass="dataTableHeader" width="160" sortable="true" sortBy="#{cheque.nombreBeneficiario}">
							<f:facet name="header">
								<h:outputText value="Nombre beneficiario" />
							</f:facet>
							<center>
								<h:outputText value="#{cheque.nombreBeneficiario}" />
							</center>
						</rich:column>
						<rich:column id="colFirmante1" headerClass="dataTableHeader" width="160" sortable="true" sortBy="#{cheque.nombreFirmante1}">
							<f:facet name="header">
								<h:outputText value="Firmante 1" />
							</f:facet>
							<center>
								<h:outputText value="#{cheque.nombreFirmante1}" />
							</center>
						</rich:column>
						<rich:column id="colEstado1" headerClass="dataTableHeader" width="80" sortable="true" sortBy="#{cheque.estadoFirmante1}">
							<f:facet name="header">
								<h:outputText value="Estado 1" />
							</f:facet>
							<center>
								<h:outputText value="Pendiente" rendered="#{cheque.estadoFirmante1 eq 'P'}" />
								<h:outputText value="Aprobado" rendered="#{cheque.estadoFirmante1 eq 'A'}" />
								<h:outputText value="Rechazado" rendered="#{cheque.estadoFirmante1 eq 'R'}" />

							</center>
						</rich:column>
						<rich:column id="colFirmante2" headerClass="dataTableHeader" width="160" sortable="true" sortBy="#{cheque.nombreFirmante2}">
							<f:facet name="header">
								<h:outputText value="Firmante 2" />
							</f:facet>
							<center>
								<h:outputText value="#{cheque.nombreFirmante2}" />
							</center>
						</rich:column>
						<rich:column id="colEstado2" headerClass="dataTableHeader" width="80" sortable="true" sortBy="#{cheque.estadoFirmante2}">
							<f:facet name="header">
								<h:outputText value="Estado 2" />
							</f:facet>
							<center>
								<h:outputText value="Pendiente" rendered="#{cheque.estadoFirmante2 eq 'P'}" />
								<h:outputText value="Aprobado" rendered="#{cheque.estadoFirmante2 eq 'A'}" />
								<h:outputText value="Rechazado" rendered="#{cheque.estadoFirmante2 eq 'R'}" />
							</center>
						</rich:column>
						<rich:column id="colEstadoCheque" headerClass="dataTableHeader" width="80" sortable="true" sortBy="#{cheque.estadoCheque}"
							style="background:#E2F6E2">
							<f:facet name="header">
								<h:outputText value="Estado" />
							</f:facet>
							<center>
								<h:outputText value="Pendiente" rendered="#{cheque.estadoCheque eq 'P'}" />
								<h:outputText value="Aprobado" rendered="#{cheque.estadoCheque eq 'A'}" />
								<h:outputText value="Rechazado" rendered="#{cheque.estadoCheque eq 'R'}" />
							</center>
						</rich:column>
						<rich:column id="colRechazo" headerClass="dataTableHeader" width="350" sortable="true" sortBy="#{cheque.motivoRechazo}">
							<f:facet name="header">
								<h:outputText value="Mot. Rechazo" />
							</f:facet>
							<center>
								<h:outputText value="#{cheque.motivoRechazo}" />
							</center>
						</rich:column>

						<rich:column id="colSel" headerClass="dataTableHeader" width="100" sortable="true">
							<f:facet name="header">
								<h:panelGroup style="width:100px;" layout="block">

									<script type="text/javascript">
                        //<![CDATA[
                            function checkAllCheckboxesInTable( inputId, state ){
                              var commonIdPart = inputId.substr(0, inputId.lastIndexOf(':'));
                              var tableId = commonIdPart + ':tu'
                              var tableElement = document.getElementById( tableId );
                              var inputs = tableElement.getElementsByTagName('input');
                              for (var i = 0; i <= inputs.length; i++){
                                  var input = inputs[i];
                                  if( input.getAttribute('type') == 'checkbox' && state){
                                    input.setAttribute('checked', state);
                                  }else{
                                    input.removeAttribute('checked');
                                  }
                              }
                            }
                            //]]>
                          </script>
									<h:selectBooleanCheckbox id="checkAll" title="#seleccionar" onclick="checkAllCheckboxesInTable( this.id, this.checked );">
										<a4j:support event="onchange" reRender="IdList" />
									</h:selectBooleanCheckbox>
									<h:outputText value="Seleccionar" />
								</h:panelGroup>
							</f:facet>
							<h:selectBooleanCheckbox id="checkEntry" value="#{cheque.seleccionado}" disabled="false" />
						</rich:column>

						<f:facet name="footer">
							<rich:datascroller id="ds" for="tblCheques" maxPages="10"></rich:datascroller>
						</f:facet>
					</rich:extendedDataTable>
				</div>


				<h:panelGrid cellspacing="5" columns="4" style="margin:0 auto">
					<a4j:commandButton id="btnCallReactivar" value="Reactivar" action="#{impresionController.prepararReactivar}"
						oncomplete="if (#{impresionController.puedeReactivar}) #{rich:component('popupReactivar')}.show();return false" reRender="popupReactivar" />
					<a4j:commandButton id="btnCallReasignar" value="Reasignar" action="#{impresionController.prepararReasignar}"
						oncomplete="if (#{impresionController.puedeReasignar}) #{rich:component('popupReasignar')}.show();return false" reRender="popupReasignar" />
					<a4j:commandButton id="btnCallAnular" value="Anular" action="#{impresionController.prepararAnular}"
						oncomplete="if (#{impresionController.puedeAnular}) #{rich:component('popupAnular')}.show();return false" reRender="popupAnular" />
					<a4j:commandButton id="btnCallImprimir" value="Imprimir" action="#{impresionController.prepararImprimir}"
						oncomplete="if (#{impresionController.puedeImprimir}) #{rich:component('popupImprimir')}.show();return false" reRender="popupImprimir" />
				</h:panelGrid>


			</fieldset>
		</h:form>
	</rich:panel>

	<rich:modalPanel id="popupReactivar" autosized="true">
		<f:facet name="header">
			<h:outputText value="Confirmación de reactivación de cheque     " />
		</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="/imagenes/close.gif" styleClass="hidelink" id="hidelinkReactivar" />
				<rich:componentControl for="popupReactivar" attachTo="hidelinkReactivar" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		<h:form>
			<h:outputText value="¿Está seguro que desea reactivar el cheque nro: #{impresionController.chequeSeleccionado.numero}?" />
			<h:panelGrid cellspacing="5" columns="2" style="margin:0 auto">
				<a4j:commandButton id="btnAceptarReactivar" value="Aceptar" action="#{impresionController.reactivar}"
					oncomplete="#{rich:component('popupReactivar')}.hide();return false" reRender="tblCheques" />
				<a4j:commandButton id="btnCancelarReactivar" value="Cancelar" onclick="#{rich:component('popupReactivar')}.hide();return false" />
			</h:panelGrid>
		</h:form>
	</rich:modalPanel>

	<rich:modalPanel id="popupReasignar" autosized="true">
		<f:facet name="header">
			<h:outputText value="Confirmación de reasignación de cheque     " />
		</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="/imagenes/close.gif" styleClass="hidelink" id="hidelinkReasignar" />
				<rich:componentControl for="popupReasignar" attachTo="hidelinkReasignar" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		<h:form>
			<h:panelGrid>
				<h:panelGrid cellspacing="5" columns="2">
					<h:outputText value="Número de cheque: " />

					<h:outputText value="#{impresionController.chequeSeleccionado.numero}" />

					<h:outputText value="Nombre beneficiario: " />

					<h:outputText value="#{impresionController.chequeSeleccionado.nombreBeneficiario}" />

					<h:outputText value="Nombre firmante 1: " />

					<h:outputText value="#{impresionController.chequeSeleccionado.nombreFirmante1}" />

					<h:outputText value="Nombre firmante 2: " />

					<h:outputText value="#{impresionController.chequeSeleccionado.nombreFirmante2}" />

					<h:outputText value="Tipo de moneda: " />

					<h:outputText value="#{impresionController.chequeSeleccionado.tipoMoneda}" />

					<h:outputText value="Importe: " />

					<h:outputText value="#{impresionController.chequeSeleccionado.importe}" />


				</h:panelGrid>

				<h:selectOneMenu id="selectPar" value="#{impresionController.codigoPar}">
					<f:selectItems value="#{impresionController.pares}" />
				</h:selectOneMenu>

				<h:outputText value="¿Está seguro que desea reasignar el cheque?" />

				<h:outputText value="Ingrese el motivo de reasignación: " />

				<h:inputTextarea id="txtMotivoReasignacion" value="#{impresionController.chequeSeleccionado.motivoReasignacion}" cols="50" rows="3"
					required="true" requiredMessage="Obligatorio" />
				<rich:message for="txtMotivoReasignacion" style="color: red;">
					<f:facet name="errorMarker">
						<h:graphicImage url="../imagenes/error.png" />
					</f:facet>
				</rich:message>
				<h:panelGrid cellspacing="5" columns="2" style="margin:0 auto">
					<a4j:commandButton id="btnAceptarReasignar" value="Aceptar" action="#{impresionController.reasignar}"
						oncomplete="if(validar()){#{rich:component('popupReasignar')}.hide();return false}" reRender="tblCheques" />
					<a4j:commandButton id="btnCancelarReasignar" value="Cancelar" onclick="#{rich:component('popupReasignar')}.hide();return false" />
				</h:panelGrid>
			</h:panelGrid>
		</h:form>
	</rich:modalPanel>

	<rich:modalPanel id="popupAnular" autosized="true">
		<f:facet name="header">
			<h:outputText value="Confirmación de anulación de cheque     " />
		</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="/imagenes/close.gif" styleClass="hidelink" id="hidelinkAnular" />
				<rich:componentControl for="popupAnular" attachTo="hidelinkAnular" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		<h:form>
			<a4j:region>

				<h:panelGrid>
					<h:outputText value="Usted esta a punto de anular el siguiente cheque" />
					<a4j:outputPanel id="pnlCheque">
						Nº Cheque: <h:outputText value=" #{impresionController.chequeSeleccionado.numero}" />
						<br />
						Banco: <h:outputText value=" #{impresionController.chequeSeleccionado.banco}" />
						<br />
						Nombre Beneficiario: <h:outputText value=" #{impresionController.chequeSeleccionado.nombreBeneficiario}" />
						<br />
						Moneda: <h:outputText value=" #{impresionController.chequeSeleccionado.tipoMoneda}" />
						<br />
						Importe:<h:outputText value=" #{impresionController.chequeSeleccionado.importe}" />
						<br />
						Estado: <h:outputText value=" Impreso" rendered="#{impresionController.chequeSeleccionado.estadoCheque eq 'I' }" />
						<h:outputText value=" Pendiente" rendered="#{impresionController.chequeSeleccionado.estadoCheque eq 'P' }" />
						<h:outputText value=" Rechazado" rendered="#{impresionController.chequeSeleccionado.estadoCheque eq 'R' }" />
						<h:outputText value=" Aprobado" rendered="#{impresionController.chequeSeleccionado.estadoCheque eq 'A' }" />
					</a4j:outputPanel>


					<h:outputText value="¿Está seguro que desea anular el cheque?" />

					<h:outputText value="Ingrese el motivo de anulación" />

					<h:inputTextarea id="txtMotivo" value="#{impresionController.chequeSeleccionado.motivoAnulacion}" cols="50" rows="3" required="true"
						requiredMessage="Obligatorio" />
					<rich:message for="txtMotivo" style="color: red;">
						<f:facet name="errorMarker">
							<h:graphicImage url="../imagenes/error.png" />
						</f:facet>
					</rich:message>

				</h:panelGrid>

				<center>
					<h:panelGrid columns="2">
						<a4j:commandButton id="btnAceptarAnular" value="Aceptar" action="#{impresionController.anular}"
							oncomplete="if(validar()){#{rich:component('popupAnular')}.hide()}" reRender="tblCheques" />
						<a4j:commandButton id="btnCancelarAnular" value="Cancelar" onclick="#{rich:component('popupAnular')}.hide()" />
					</h:panelGrid>
				</center>
			</a4j:region>
		</h:form>
	</rich:modalPanel>

	<rich:modalPanel id="popupImprimir" autosized="true">
		<f:facet name="header">
			<h:outputText value="Confirmación de impresión de cheques " />

		</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="/imagenes/close.gif" styleClass="hidelink" id="hidelinkImprimir" />
				<rich:componentControl for="popupImprimir" attachTo="hidelinkImprimir" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		<h:form>
			<h:outputText value="¿Está seguro que desea imprimir el(los) #{impresionController.total} cheque(s) seleccionado(s)?" />
			<h:panelGrid cellspacing="5" columns="2" style="margin:0 auto">
				<a4j:commandButton id="btnAceptarReactivar" value="Aceptar" action="#{impresionController.imprimir}"
					oncomplete="#{rich:component('popupImprimir')}.hide();return false" reRender="tblCheques" />
				<a4j:commandButton id="btnCancelarReactivar" value="Cancelar" onclick="#{rich:component('popupImprimir')}.hide();return false" />
			</h:panelGrid>
		</h:form>
	</rich:modalPanel>

</body>
</html>