<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">
<a4j:keepAlive beanName="consultarPagosController" />


<head>

</head>


<body>
	<rich:panel id="pnlModulo" height="100%">
		<f:facet name="header">
			<h:outputText value="Tesorería > Módulo de pagos">
			</h:outputText>
		</f:facet>
		<h:form id="formPagos">


			<fieldset>

				<table>
					<tr>
						<td><h:outputText style="font-size:11px;" value="Proveedor:" /></td>
						<td><h:inputText id="idProveedorFrom" maxlength="20" value="#{consultarPagosController.idProveedorFrom}" required="true"
								requiredMessage="Obligatorio" immediate="true" /> <rich:message for="idPeriodoTo" style="color: red;">
								<f:facet name="errorMarker">
									<h:graphicImage url="../imagenes/error.png" />
								</f:facet>
							</rich:message></td>
						<td><h:outputText style="font-size:11px;" value="o" /></td>
						<td><h:inputText id="idProveedorTo" maxlength="20" value="#{consultarPagosController.idProveedorTo}" required="true"
								requiredMessage="Obligatorio" immediate="true" /> <rich:message for="idPeriodoTo" style="color: red;">
								<f:facet name="errorMarker">
									<h:graphicImage url="../imagenes/error.png" />
								</f:facet>
							</rich:message></td>
						<td><h:outputText style="font-size:11px;" value="Periodo" /></td>
						<td><h:inputText id="idPeriodoFrom" maxlength="10" value="#{consultarPagosController.fecPeriodoInicio}" required="true"
								requiredMessage="Obligatorio" immediate="true" /> <rich:message for="idPeriodoFrom" style="color: red;">
								<f:facet name="errorMarker">
									<h:graphicImage url="../imagenes/error.png" />
								</f:facet>
							</rich:message></td>
						<td><h:outputText style="font-size:11px;" value="o" /></td>
						<td><h:inputText id="idPeriodoTo" maxlength="10" value="#{consultarPagosController.fecPeriodoFin}" required="true"
								requiredMessage="Obligatorio" immediate="true" /> <rich:message for="idPeriodoTo" style="color: red;">
								<f:facet name="errorMarker">
									<h:graphicImage url="../imagenes/error.png" />
								</f:facet>
							</rich:message></td>

					</tr>
					<tr>
						<td colspan="8"></td>
						<td><a4j:commandButton id="btnBuscar" action="#{consultarPagosController.consultarProcesos}" style="width:125px"
								reRender="listapago2,btnEditar,medioPago,tipoMarcador,tipoCtaBanco,idFechaPago,idFechaTransaccion,
								mostrarSelec,btnProcesar"
								value="Buscar" execute="@this" process="idProveedorFrom,idProveedorTo,idPeriodoFrom,idPeriodoTo" /></td>
						<td><a4j:commandButton id="btnLimpiar" action="#{consultarPagosController.limpiarFiltros}" style="width:125px" value="Limpiar"
								reRender="idProveedorFrom,idProveedorTo,idGlosaPago,idReferencia,idPeriodoFrom,idPeriodoTo,idFechaPago,listapago2,idFechaTransaccion" /></td>
					</tr>
				</table>
			</fieldset>

			<fieldset>
				<legend>Tipo de Cambio del Dia</legend>
				<table>
					<tr>
						<td><h:outputText value="EUR-PEN" /></td>
						<td><h:inputText id="idEuroSoles" maxlength="4" value="#{consultarPagosController.valEuroSoles}" style="background:#ddd;" readonly="true" /></td>
						<td><h:outputText value="USD-PEN" /></td>
						<td><h:inputText id="idDolarSoles" maxlength="6" value="#{consultarPagosController.valDolarSoles}" style="background:#ddd;" readonly="true" /></td>
						<td><h:outputText value="EUR-USD" /></td>
						<td><h:inputText id="idEurosDolares" maxlength="6" value="#{consultarPagosController.valEuroDolares}" style="background:#ddd;"
								readonly="true" /></td>
					</tr>
				</table>
			</fieldset>

			<fieldset>
				<legend>Datos del Pago</legend>
				<table border="0px" style="border-collapse: collapse;">
					<tr>
						<td><h:outputText style="font-size:11px;" value="Fecha de Pago:" /></td>
						<td><rich:calendar id="idFechaPago" enableManualInput="true" datePattern="yyyy-MM-dd" value="#{consultarPagosController.fecPago}"
								required="#{consultarPagosController.datosPagoObligRequerid}" requiredMessage="Obligatorio" immediate="true" reRender="formPagos">
							</rich:calendar> <rich:message for="idFechaPago" style="color: red;">
								<f:facet name="errorMarker">
									<h:graphicImage url="../imagenes/error.png" />
								</f:facet>
							</rich:message></td>

						<td><h:outputText style="font-size:11px;" value="Cta Banco:" /></td>
						<td><h:selectOneMenu id="tipoCtaBanco" value="#{consultarPagosController.numCuentaBanco}" requiredMessage="Obligatorio" immediate="true"
								reRender="formPagos,tipoPago">
								<f:selectItems value="#{consultarPagosController.listaCtaBanco}" />
							</h:selectOneMenu> <rich:message for="tipoCtaBanco" style="color:RED;">
								<f:facet name="errorMarker">
									<h:graphicImage url="../imagenes/error.png" />
								</f:facet>
							</rich:message></td>
						<td><h:outputText style="font-size:11px;" value="Tipo Pago:" /></td>
						<td><h:selectOneMenu id="tipoPago" value="#{consultarPagosController.idTipoPago}" requiredMessage="Obligatorio">
								<f:selectItems value="#{consultarPagosController.tipoPagoItems}" />
								<a4j:support event="onchange" action="#{consultarPagosController.mostrarDetract}" reRender="btnReferencias,panelDetrac" />
							</h:selectOneMenu></td>

					</tr>
					<tr>
						<td><h:outputText style="font-size:11px;" value="Fecha de Transaccion:" /></td>
						<td><rich:calendar id="idFechaTransaccion" enableManualInput="true" datePattern="yyyy-MM-dd"
								value="#{consultarPagosController.fecTransaccion}" required="#{consultarPagosController.datosPagoObligRequerid}" requiredMessage="Obligatorio"
								immediate="true" reRender="formPagos">
								<a4j:support event="onchanged" reRender="idEuroSoles,idDolarSoles,idEurosDolares" action="#{consultarPagosController.actualizarTiposCambio}" />
								<!-- 									ajxSingle="true" /> -->
							</rich:calendar> <rich:message for="idFechaTransaccion" style="color: red;">
								<f:facet name="errorMarker">
									<h:graphicImage url="../imagenes/error.png" />
								</f:facet>
							</rich:message></td>
						<td><h:outputText style="font-size:11px;" value="Marcador" /></td>
						<td><h:selectOneMenu id="tipoMarcador" value="#{consultarPagosController.idMarcador}" requiredMessage="Obligatorio" immediate="true"
								reRender="formPagos,panelDetrac,tipoPago">
								<f:selectItems value="#{consultarPagosController.marcadorItems}" />
								<a4j:support event="onchange" action="#{consultarPagosController.mostrarDetract}" reRender="panelDetrac,btnReferencias,tipoPago" />

							</h:selectOneMenu> <rich:message for="tipoMarcador" style="color: red;">
								<f:facet name="errorMarker">
									<h:graphicImage url="../imagenes/error.png" />
								</f:facet>
							</rich:message></td>
						<td><h:outputText style="font-size:11px;" value="Medio Pago:" /></td>
						<td><h:selectOneMenu id="medioPago" value="#{consultarPagosController.idMedioPago}" requiredMessage="Obligatorio" immediate="true"
								reRender="formPagos">
								<f:selectItems value="#{consultarPagosController.medioPagoItems}" />
								<a4j:support event="onchange" action="#{consultarPagosController.mostrarDetract}" reRender="panelDetrac,tipoPago" />
							</h:selectOneMenu> <rich:message for="medioPago" style="color:RED;">
								<f:facet name="errorMarker">
									<h:graphicImage url="../imagenes/error.png" />
								</f:facet>
							</rich:message></td>
					</tr>
					<tr>
						<td><h:outputText style="font-size:11px;" value="Glosa Pago:" /></td>
						<td colspan="1"><h:inputText id="idGlosaPago" maxlength="100" value="#{consultarPagosController.glosaPago}" style=" width : 369px;" /></td>
						<td><h:outputText style="font-size:11px;" value="Referencia: " /></td>
						<td><h:inputText id="idReferencia" maxlength="100" value="#{consultarPagosController.referencia}"></h:inputText></td>

					</tr>
				</table>
			</fieldset>

			<!-- #{consultarPagosController.detrac} -->
			<a4j:outputPanel id="panelDetrac">
				<h:panelGroup rendered="#{consultarPagosController.detrac}">
					<fieldset>
						<legend>Detracciones</legend>
						<table>
							<tr>
								<td><h:outputText value="Nro. Lote" /></td>
								<td><h:inputText id="idNroLote" maxlength="6" value="#{consultarPagosController.nroLote}" required="false" requiredMessage="Obligatorio"
										readonly="#{consultarPagosController.desabLoteComision}" style="background:#ddd;" styleClass="loteCom" /> <rich:message for="idNroLote"
										style="color: red;">
										<f:facet name="errorMarker">
											<h:graphicImage url="../imagenes/error.png" />
										</f:facet>
									</rich:message></td>
								<td><h:outputText value="Operacion Banco" /></td>
								<td><h:inputText id="idOpBanco" maxlength="10" value="#{consultarPagosController.opBanco}" required="false" requiredMessage="Obligatorio"
										style="background:#ddd;" /> <rich:message for="idOpBanco" style="color: red;">
										<f:facet name="errorMarker">
											<h:graphicImage url="../imagenes/error.png" />
										</f:facet>
									</rich:message></td>
								<td><h:outputText value="Operacion Comision" /></td>
								<td><h:inputText id="idOpComision" maxlength="10" value="#{consultarPagosController.opComision}" required="false"
										requiredMessage="Obligatorio" readonly="#{consultarPagosController.desabLoteComision}" style="background:#ddd;" styleClass="loteCom" /> <rich:message
										for="idOpComision" style="color: red;">
										<f:facet name="errorMarker">
											<h:graphicImage url="../imagenes/error.png" />
										</f:facet>
									</rich:message></td>
							</tr>
						</table>
					</fieldset>
				</h:panelGroup>
			</a4j:outputPanel>

			<div align="right">
				<table>
					<tr>
						<td></td>

						<td><a4j:commandButton id="btnEditar" action="#{consultarPagosController.actualizar}" style="width:125px" value="Editar"
								reRender="panelRegistroContable" oncomplete="#{rich:component('panelRegistroContable')}.show()"
								disabled="#{consultarPagosController.desabEditar}" /></td>
					</tr>
				</table>

			</div>
			<fieldset>
				<legend>Filtros</legend>
				<div align="center">
					<table>
						<tr>
							<td style="font-size: 13px;"><h:outputText value="Proveedor" id="suggest" /></td>
							<td><a4j:region>
									<h:inputText id="filtroProv" value="#{consultarPagosController.filtroProv}">
										<a4j:support event="onkeyup" action="#{consultarPagosController.filtrar}" reRender="listapago2,desmarc,mostrarSelec" status="XXX" />
									</h:inputText>
								</a4j:region></td>
							<td style="font-size: 13px;">Referencia</td>
							<td><a4j:region>
									<h:inputText id="filtroRef" style=" width : 78px;" value="#{consultarPagosController.filtroRef}">
										<a4j:support event="onkeyup" action="#{consultarPagosController.filtrar}" reRender="listapago2,desmarc,mostrarSelec" />
									</h:inputText>
								</a4j:region></td>
							<td style="font-size: 13px;">Nro Diario</td>
							<td><a4j:region>
									<h:inputText id="filtroNumDia" style=" width : 54px;" value="#{consultarPagosController.filtroNumDia}">
										<a4j:support event="onkeyup" action="#{consultarPagosController.filtrar}" reRender="listapago2,desmarc,mostrarSelec" />
									</h:inputText>
								</a4j:region></td>
							<td style="font-size: 13px;">Mostrar seleccionados:</td>
							<td><h:selectBooleanCheckbox id="mostrarSelec" value="#{consultarPagosController.mostrarSelec}" style=" width : 30px;"
									reRender="listapago2,desmarc,mostrarSelec">
									<a4j:support event="onchange" action="#{consultarPagosController.onSelectOneSeleccionados}"
										reRender="listapago2,desmarc,mostrarSelec,filtroProv,filtroRef,filtroNumDia,btnReferencias,
								listaMarcados" />
								</h:selectBooleanCheckbox></td>
							<td style="font-size: 13px;">Desmarcar Todo:</td>
							<td><h:selectBooleanCheckbox id="desmarc" value="#{consultarPagosController.desmarc}" style=" width : 30px;" reRender="listapago2,desmarc">
									<a4j:support event="onchange" action="#{consultarPagosController.onSelectOneBooleanChange}"
										reRender="listapago2,desmarc,filtroProv,filtroRef,filtroNumDia" />
								</h:selectBooleanCheckbox></td>
							<td></td>
							<td><a4j:commandButton id="btnReferencias" style="width:155px" value="Agregar Referencias"
									action="#{consultarPagosController.agregarReferencias}" disabled="#{consultarPagosController.desabAgregarRef}"
									oncomplete="#{rich:component('panelReferencias')}.show()" reRender="panelReferencias">
								</a4j:commandButton></td>
						</tr>
					</table>

				</div>
			</fieldset>
			<fieldset>
				<!-- Aqui va la tabla -->
				<div align="center" style="scrollbar-base-color: #3d8a3d; width: 1080px; border: 0px solid white; overflow-x: scroll">
					<rich:extendedDataTable id="listapago2" var="proc" value="#{consultarPagosController.listaProcesos}" width="1075px" height="1000px"
						selection="#{consultarPagosController.selection}" selectionMode="single" reRender="ds">

						<rich:column id="codigoCuenta" headerClass="dataTableHeader" width="10%" sortable="true" sortBy="#{proc.codigoCuenta}">
							<f:facet name="header">
								<h:outputText value="Cuenta" />
							</f:facet>
							<center>
								<h:outputText value="#{proc.codigoCuenta}" />
							</center>
						</rich:column>

						<rich:column id="nombProveedor" headerClass="dataTableHeader" width="30%" sortable="true" sortBy="#{proc.nombreProveedor}">
							<f:facet name="header">
								<h:outputText value="Nombre Proveedor" />
							</f:facet>
							<center>
								<h:outputText value="#{proc.nombreProveedor}" />
							</center>
						</rich:column>

						<rich:column id="referencia" headerClass="dataTableHeader" width="9%" sortable="true" sortBy="#{proc.referencia}">
							<f:facet name="header">
								<h:outputText value="Referencia" />
							</f:facet>
							<center>
								<h:outputText value="#{proc.referencia}" />
							</center>
						</rich:column>

						<rich:column id="glosa" headerClass="dataTableHeader" width="23%" sortable="true" sortBy="#{proc.glosa}">
							<f:facet name="header">
								<h:outputText value="Glosa" />
							</f:facet>
							<center>
								<h:outputText value="#{proc.glosa}" />
							</center>
						</rich:column>


						<rich:column id="dc" headerClass="dataTableHeader" sortable="true" sortBy="#{proc.debitoCredito}" width="3%">
							<f:facet name="header">
								<h:outputText value="D/C" />
							</f:facet>
							<center>
								<h:outputText value="#{proc.debitoCredito}" />
							</center>
						</rich:column>

						<rich:column id="moneda" headerClass="dataTableHeader" sortable="true" sortBy="#{proc.moneda}" width="5%">
							<f:facet name="header">
								<h:outputText value="Moneda" />
							</f:facet>
							<center>
								<h:outputText value="#{proc.moneda}" />
							</center>
						</rich:column>

						<rich:column id="impTransaccionAmount" headerClass="dataTableHeader" width="6%" sortable="true" sortBy="#{proc.impTransaccionAmount}">
							<f:facet name="header">
								<h:outputText value="Imp. Trans." />
							</f:facet>
							<center>
								<h:outputText value="#{proc.impTransaccionAmount}" style="float:right">
									<f:convertNumber locale="en_US" />
								</h:outputText>
							</center>
						</rich:column>

						<rich:column id="impSoles" headerClass="dataTableHeader" width="6%" sortable="true" sortBy="#{proc.impSoles}">
							<f:facet name="header">
								<h:outputText value="Imp. Soles" />
							</f:facet>
							<center>
								<h:outputText value="#{proc.impSoles}" style="float:right">
									<f:convertNumber locale="en_US" />
								</h:outputText>
							</center>
						</rich:column>

						<rich:column id="nroDiario" headerClass="dataTableHeader" width="5%" sortable="true" sortBy="#{proc.diario}">
							<f:facet name="header">
								<h:outputText value="Nro Diario" />
							</f:facet>
							<center>
								<h:outputText value="#{proc.diario}" />
							</center>
						</rich:column>

						<rich:column style="text-align: center;" styleClass="taskCheckBoxWidth" headerClass="dataTableHeader" width="5%" sortable="true"
							sortBy="#{proc.flagPago}">
							<f:facet name="header">
								<h:outputText value="Pagar" />
							</f:facet>
							<center>
								<h:selectBooleanCheckbox value="#{proc.bFlagPago}" valueChangeListener="#{consultarPagosController.editarReg}">
									<a4j:support event="onchange" />
								</h:selectBooleanCheckbox>
							</center>

						</rich:column>

						<f:facet name="footer">
							<rich:datascroller id="ds" for="listapago2" maxPages="12"></rich:datascroller>
						</f:facet>
					</rich:extendedDataTable>
				</div>
			</fieldset>
			<fieldset>
				<div align="right">
					<a4j:commandButton id="btnProcesar" action="#{consultarPagosController.obtenerAsiento}" style=" width : 125px;"
						oncomplete="if (#{consultarPagosController.pasoValidaciones}) 
								#{rich:component('panelAsientoContable')}.show();"
						value="Procesar Asientos" reRender="listaAsientoContable,panelAsientoContable,mostrarSelec" disabled="#{consultarPagosController.desabProcesar}">
					</a4j:commandButton>
				</div>
			</fieldset>

		</h:form>
	</rich:panel>
	<rich:modalPanel id="panelRegistroContable" autosized="true">
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="/imagenes/close.gif" styleClass="hidelink" id="hidelink2" />
				<rich:componentControl for="panelRegistroContable" attachTo="hidelink2" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		<h:form>
		Editando.....
		 <a4j:region>
				<a4j:include viewId="/paginas/tesoreria/manRegistroContable.xhtml" />
			</a4j:region>
		</h:form>
	</rich:modalPanel>


	<rich:modalPanel id="panelAsientoContable" autosized="true">
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="/imagenes/close.gif" styleClass="hidelink" id="hidelink" />
				<rich:componentControl for="panelAsientoContable" attachTo="hidelink" operation="hide" event="onclick"
					action="#{consultarPagosController.retornarAsientos}" />
			</h:panelGroup>
		</f:facet>
		<h:form>
			<a4j:region>
				<a4j:include viewId="/paginas/tesoreria/manAsientosContables.xhtml" />
			</a4j:region>
		</h:form>
	</rich:modalPanel>
	<!-- <rich:messages></rich:messages> -->

	<rich:modalPanel id="panelReferencias" autosized="true">
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="/imagenes/close.gif" styleClass="hidelinkx" id="hidelink3" />
				<rich:componentControl for="panelReferencias" attachTo="hidelink3" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		<h:form>
			<h2>LISTA DE PROVEEDORES SELECCIONADOS</h2>
			<a4j:region>
				<rich:extendedDataTable id="listaMarcados" var="prov" value="#{consultarPagosController.listaMarcados}" width="920px" height="300px">

					<rich:column id="CtaProveedor" headerClass="dataTableHeader" width="300px">
						<f:facet name="header">
							<h:outputText value="Proveedor" />
						</f:facet>
						<center>
							<h:outputText value="#{prov.nomProveedor}" />
						</center>
					</rich:column>

					<rich:column id="GlosaX" headerClass="dataTableHeader" width="460px">
						<f:facet name="header">
							<h:outputText value="Glosa" />
						</f:facet>
						<center>
							<h:inputText value="#{prov.glosa}" style=" width : 450px;" />
						</center>
					</rich:column>

					<rich:column id="ReferenciaX" headerClass="dataTableHeader" width="150px">
						<f:facet name="header">
							<h:outputText value="Referencia" />
						</f:facet>
						<center>
							<h:inputText value="#{prov.referencia}" style=" width : 150px;">
								<a4j:support event="onkeyup" action="#{consultarPagosController.cambiarGlosas}" reRender="GlosaX" />
							</h:inputText>
						</center>
					</rich:column>
				</rich:extendedDataTable>
			</a4j:region>
			<div align="right">
				<a4j:commandButton id="btnGuardarRef" style="width:90px" value="Guardar" action="#{consultarPagosController.actualizarReferencias}"
					oncomplete="#{rich:component('panelReferencias')}.hide()" />
			</div>
		</h:form>
	</rich:modalPanel>
</body>
</html>