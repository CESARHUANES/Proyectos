<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets">
<a4j:keepAlive beanName="firmanteController" />
<head>
<style type="text/css">
body {
	font-size: 11px;
	color: #000;
	font-family: Arial, Verdana, sans-serif;
}

.extdt-menu-div-out, .extdt-menu-div-on {
	display: none !important;
}

td {
	vertical-align: top;
}
</style>


<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<meta http-equiv="pragma" content="no-cache" />


<script type="text/javascript">

function validar(){

	var length=document.querySelectorAll('.rich-message-marker').length;
	console.info(length);
	return length==0;
}

</script>
</head>
<body>
	<rich:panel id="pnlValidacion">
		<f:facet name="header">
			<h:form id="frmActualizar">
				<h:outputText value="Tesorería > Validación de Firmantes">
				</h:outputText>

				<a4j:commandLink action="#{firmanteController.inicio}" reRender="principal" style="text-decoration:none; margin-left:10px">
					<img src="#{facesContext.externalContext.requestContextPath}/imagenes/refresh.png" width="15" height="15" style="margin: 0; padding: 0" />
				</a4j:commandLink>
			</h:form>

		</f:facet>
		<h:form id="frmFirmantes">

			<fieldset style="margin-bottom: 20px; padding: 20px;">
				<legend>Listado de firmantes pendientes de aprobación</legend>

				<rich:extendedDataTable id="tblFirmantesPendientes" var="firmante" value="#{firmanteController.firmantesTemporales}" width="700px" height="260px"
					rows="10" selectedClass="dataTableSelectedRow" sortMode="single" selection="#{firmanteController.selectionTemp}" selectionMode="single"
					reRender="true">
					<a4j:support event="onselectionchange" reRender="pnlOpcionesTemp" action="#{firmanteController.seleccionarFirmanteTemporal}" ajaxSingle="true" />

					<rich:column id="colUsuario" headerClass="dataTableHeader" width="100" sortable="true" sortBy="#{firmante.usuario}">
						<f:facet name="header">
							<h:outputText value="Usuario" />
						</f:facet>
						<center>
							<h:outputText value="#{firmante.usuario}" />
						</center>
					</rich:column>
					<rich:column id="colNombres" headerClass="dataTableHeader" width="100" sortable="true" sortBy="#{firmante.nombres}">
						<f:facet name="header">
							<h:outputText value="Nombres" />
						</f:facet>
						<center>
							<h:outputText value="#{firmante.nombres}" />
						</center>
					</rich:column>
					<rich:column id="colApellidos" headerClass="dataTableHeader" width="100" sortable="true" sortBy="#{firmante.apellidos}">
						<f:facet name="header">
							<h:outputText value="Apellidos" />
						</f:facet>
						<center>
							<h:outputText value="#{firmante.apellidos}" />
						</center>
					</rich:column>
					<rich:column id="colCorreo" headerClass="dataTableHeader" width="200" sortable="true" sortBy="#{firmante.correo}">
						<f:facet name="header">
							<h:outputText value="Correo" />
						</f:facet>
						<center>
							<h:outputText value="#{firmante.correo}" />
						</center>
					</rich:column>
					<rich:column id="colAccion" headerClass="dataTableHeader" width="100" sortable="true" sortBy="#{firmante.nombreAccion}">
						<f:facet name="header">
							<h:outputText value="Accion" />
						</f:facet>
						<center>
							<h:outputText value="#{firmante.nombreAccion}" />
						</center>
					</rich:column>
					<!--         <rich:column id="colMotivoAccion" headerClass="dataTableHeader" width="200" sortable="true" sortBy="#{firmante.motivoAccion}"> -->
					<!--           <f:facet name="header"> -->
					<!--             <h:outputText value="Motivo de acción" /> -->
					<!--           </f:facet> -->
					<!--           <center> -->
					<!--             <h:outputText value="#{firmante.motivoAccion}" /> -->
					<!--           </center> -->
					<!--         </rich:column> -->
					<rich:column id="colEstadoAccion" headerClass="dataTableHeader" width="100" sortable="true" sortBy="#{firmante.estadoAccion}">
						<f:facet name="header">
							<h:outputText value="Estado de acción" />
						</f:facet>
						<center>
							<h:outputText rendered="#{firmante.estadoAccion eq 'P'}" value="Pendiente" />
							<h:outputText rendered="#{firmante.estadoAccion eq 'R'}" value="Rechazado" />
						</center>
					</rich:column>
					<!--         <rich:column id="colMotivoRechazo" headerClass="dataTableHeader" width="200" sortable="true" sortBy="#{firmante.motivoRechazo}"> -->
					<!--           <f:facet name="header"> -->
					<!--             <h:outputText value="Motivo de rechazo" /> -->
					<!--           </f:facet> -->
					<!--           <center> -->
					<!--             <h:outputText value="#{firmante.motivoRechazo}" /> -->
					<!--           </center> -->
					<!--         </rich:column> -->
					<f:facet name="footer">
						<rich:datascroller id="ds" for="tblFirmantesPendientes" maxPages="10"></rich:datascroller>
					</f:facet>
				</rich:extendedDataTable>
				<h:panelGrid id="pnlOpcionesTemp" style="padding-top:20px">
					<a4j:commandButton id="btnVerTemp" value="Ver" reRender="popupVerTemp" oncomplete="#{rich:component('popupVerTemp')}.show(); return false;"
						disabled="#{empty firmanteController.firmanteTemp}" action="#{firmanteController.prepararVisualizacionTemp}" />

				</h:panelGrid>
			</fieldset>

			<fieldset style="margin-bottom: 20px; padding: 20px;">
				<legend>Listado de firmantes activos</legend>

				<rich:extendedDataTable id="tblFirmantes" var="firmante" value="#{firmanteController.firmantesActivos}" width="500px" height="290px" rows="10"
					selectedClass="dataTableSelectedRow" sortMode="single" selection="#{firmanteController.selectionActivo}" selectionMode="single" reRender="true">
					<a4j:support event="onselectionchange" reRender="pnlOpcionesActivo" action="#{firmanteController.seleccionarFirmanteActivo}" ajaxSingle="true" />

					<rich:column id="colUsuario" headerClass="dataTableHeader" width="100" sortable="true" sortBy="#{firmante.usuario}">
						<f:facet name="header">
							<h:outputText value="Usuario" />
						</f:facet>
						<center>
							<h:outputText value="#{firmante.usuario}" />
						</center>
					</rich:column>
					<rich:column id="colNombres" headerClass="dataTableHeader" width="100" sortable="true" sortBy="#{firmante.nombres}">
						<f:facet name="header">
							<h:outputText value="Nombres" />
						</f:facet>
						<center>
							<h:outputText value="#{firmante.nombres}" />
						</center>
					</rich:column>
					<rich:column id="colApellidos" headerClass="dataTableHeader" width="100" sortable="true" sortBy="#{firmante.apellidos}">
						<f:facet name="header">
							<h:outputText value="Apellidos" />
						</f:facet>
						<center>
							<h:outputText value="#{firmante.apellidos}" />
						</center>
					</rich:column>
					<rich:column id="colCorreo" headerClass="dataTableHeader" width="200" sortable="true" sortBy="#{firmante.correo}">
						<f:facet name="header">
							<h:outputText value="Correo" />
						</f:facet>
						<center>
							<h:outputText value="#{firmante.correo}" />
						</center>
					</rich:column>
					<f:facet name="footer">
						<rich:datascroller id="ds" for="tblFirmantes" maxPages="10"></rich:datascroller>
					</f:facet>
				</rich:extendedDataTable>
				<h:panelGrid id="pnlOpcionesActivo" style="padding-top:20px">
					<a4j:commandButton id="btnVerActivo" value="Ver" reRender="popupVerActivo" oncomplete="#{rich:component('popupVerActivo')}.show(); return false;"
						disabled="#{empty firmanteController.firmanteActivo}" />
				</h:panelGrid>
			</fieldset>

		</h:form>
	</rich:panel>

	<rich:modalPanel id="popupVerTemp" height="#{firmanteController.alto}" width="#{firmanteController.ancho}">
		<f:facet name="header">
			<h:outputText value="#{firmanteController.firmanteTemp.nombreAccion} Firmante" />
		</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="/imagenes/close.gif" styleClass="hidelink" id="hidelinkVerTemp" />
				<rich:componentControl for="popupVerTemp" attachTo="hidelinkVerTemp" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>

		<h:panelGrid columns="2">
			<h:panelGrid width="300" height="#{firmanteController.alto-70}" style="border:1px dashed">

				<h:outputText value="Información nueva del firmante" rendered="#{firmanteController.firmanteTemp.nombreAccion eq 'Modificar'}"></h:outputText>

				<h:panelGrid columns="2">
					<h:outputLabel value="Usuario: " />
					<h:inputText id="txtUsuario" value="#{firmanteController.firmanteTemp.usuario}" readonly="true" />

					<h:outputLabel value="Nombres: " />
					<h:inputText id="txtNombres" value="#{firmanteController.firmanteTemp.nombres}" readonly="true" />

					<h:outputLabel value="Apellidos: " />
					<h:inputText id="txtApellidos" value="#{firmanteController.firmanteTemp.apellidos}" readonly="true" />

					<h:outputLabel value="Correo: " />
					<h:inputText id="txtCorreo" value="#{firmanteController.firmanteTemp.correo}" readonly="true" />

					<h:outputLabel value="Firma: " />

					<a4j:mediaOutput element="img" cacheable="false" session="false" createContent="#{firmanteController.pintar}"
						value="#{firmanteController.firmanteTemp.firma}" mimeType="image/png" style="width:210px;height:90px" />

					<h:outputLabel value="Accion: " />

					<h:inputText id="txtAccion" value="#{firmanteController.firmanteTemp.nombreAccion}" readonly="true" />

					<h:outputLabel value="Motivo de acción: " rendered="#{not empty firmanteController.firmanteTemp.motivoAccion}" />

					<h:inputTextarea id="txtMotivoAccion" value="#{firmanteController.firmanteTemp.motivoAccion}" readonly="true"
						rendered="#{not empty firmanteController.firmanteTemp.motivoAccion}" />

					<h:outputLabel value="Motivo de rechazo: " rendered="#{not empty firmanteController.firmanteTemp.motivoRechazo}" />

					<h:inputTextarea id="txtMotivoRechazo" value="#{firmanteController.firmanteTemp.motivoRechazo}" readonly="true"
						rendered="#{not empty firmanteController.firmanteTemp.motivoRechazo}" />

				</h:panelGrid>
			</h:panelGrid>

			<h:panelGrid rendered="#{firmanteController.firmanteTemp.nombreAccion eq 'Eliminar'}" width="300" height="#{firmanteController.alto-70}"
				style="border:1px dashed">
				<h:panelGrid rendered="#{not empty firmanteController.pares}">
					<p>Los siguientes pares de firmantes serán desactivados:</p>
					<rich:dataList var="par" value="#{firmanteController.pares}" title="Lista de Pares">
						<h:outputText value="#{par.firmante1}" />
						<h:outputText value=" " />
						<h:outputText value="#{par.firmante2}" />
					</rich:dataList>
				</h:panelGrid>
				<h:outputLabel value="¿Desea continuar con la operación?" rendered="#{firmanteController.firmanteTemp.estadoAccion eq 'P'}" />
			</h:panelGrid>

			<h:panelGrid rendered="#{firmanteController.firmanteTemp.nombreAccion eq 'Modificar'}" width="300" height="#{firmanteController.alto-65}"
				style="border:1px dashed">

				<h:outputText value="Información actual del firmante"></h:outputText>
				<h:panelGrid columns="2" cellspacing="4">
					<h:outputLabel value="Usuario: " />
					<h:inputText value="#{firmanteController.firmanteActual.usuario}" readonly="true" />

					<h:outputLabel value="Nombres: " />
					<h:inputText value="#{firmanteController.firmanteActual.nombres}" readonly="true" />

					<h:outputLabel value="Apellidos: " />
					<h:inputText value="#{firmanteController.firmanteActual.apellidos}" readonly="true" />

					<h:outputLabel value="Correo: " />
					<h:inputText value="#{firmanteController.firmanteActual.correo}" readonly="true" />

					<h:outputLabel value="Firma: " />

					<a4j:mediaOutput element="img" cacheable="false" session="false" createContent="#{firmanteController.pintar}"
						value="#{firmanteController.firmanteActual.firma}" mimeType="image/png" style="width:210px;height:90px" />

				</h:panelGrid>

				<h:outputLabel value="¿Desea continuar con la operación?" rendered="#{firmanteController.firmanteTemp.estadoAccion eq 'P'}" />
			</h:panelGrid>
		</h:panelGrid>

		<h:form id="validar">
			<h:panelGrid cellspacing="4" columns="2" style="margin:0 auto">
				<a4j:commandButton id="btnAprobar" value="Aprobar" action="#{firmanteController.aprobar}"
					oncomplete="#{rich:component('popupVerTemp')}.hide();return false" reRender="frmFirmantes"
					rendered="#{firmanteController.firmanteTemp.estadoAccion eq 'P'}" />
				<a4j:commandButton id="btnRechazar" value="Rechazar" action="#{firmanteController.prepararRechazo}"
					oncomplete="#{rich:component('popupRechazar')}.show();return false" reRender="popupRechazar"
					rendered="#{firmanteController.firmanteTemp.estadoAccion eq 'P'}" />
			</h:panelGrid>
		</h:form>


	</rich:modalPanel>

	<rich:modalPanel id="popupVerActivo" height="260" width="250">
		<f:facet name="header">
			<h:outputText value="Visualización de firmante Activo" />
		</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="/imagenes/close.gif" styleClass="hidelink" id="hidelinkVerActivo" />
				<rich:componentControl for="popupVerActivo" attachTo="hidelinkVerActivo" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>

		<h:panelGrid columns="2" cellspacing="5">
			<h:outputLabel value="Usuario: " />
			<h:inputText id="txtUsuarioActivo" value="#{firmanteController.firmanteActivo.usuario}" readonly="true" />

			<h:outputLabel value="Nombres: " />
			<h:inputText id="txtNombresActivo" value="#{firmanteController.firmanteActivo.nombres}" readonly="true" />

			<h:outputLabel value="Apellidos: " />
			<h:inputText id="txtApellidosActivo" value="#{firmanteController.firmanteActivo.apellidos}" readonly="true" />

			<h:outputLabel value="Correo: " />
			<h:inputText id="txtCorreoActivo" value="#{firmanteController.firmanteActivo.correo}" readonly="true" />

			<h:outputLabel value="Firma: " />

			<a4j:mediaOutput element="img" cacheable="false" session="false" createContent="#{firmanteController.pintar}"
				value="#{firmanteController.firmanteActivo.firma}" mimeType="image/png" style="width:210px;height:90px" />

		</h:panelGrid>
		<center>
			<a4j:commandButton value="Cerrar" onclick="#{rich:component('popupVerActivo')}.hide();return false" />
		</center>
	</rich:modalPanel>
	<rich:modalPanel id="popupRechazar" height="150" width="300">
		<f:facet name="header">
			<h:outputText value="Ingresar motivo de rechazo" />
		</f:facet>
		<f:facet name="controls">
			<h:panelGroup>
				<h:graphicImage value="/imagenes/close.gif" styleClass="hidelink" id="hidelinkRechazar" />
				<rich:componentControl for="popupRechazar" attachTo="hidelinkRechazar" operation="hide" event="onclick" />
			</h:panelGroup>
		</f:facet>
		<h:form id="frmConfirmar">
			<h:panelGrid columns="2" cellspacing="5">
				<h:outputLabel value="Motivo de rechazo: " />
				<h:inputTextarea id="txtRechazo" value="#{firmanteController.firmanteTemp.motivoRechazo}" required="true" requiredMessage="Obligatorio" />
				<h:outputLabel value="" />
				<rich:message for="txtRechazo" style="color: red;">
					<f:facet name="errorMarker">
						<h:graphicImage url="../imagenes/error.png" />
					</f:facet>
				</rich:message>
				<center>
					<a4j:commandButton id="btnConfirmar" value="Rechazar" action="#{firmanteController.rechazar}" reRender="frmFirmantes"
						oncomplete="if(validar()){#{rich:component('popupRechazar')}.hide();#{rich:component('popupVerTemp')}.hide();return false}"></a4j:commandButton>
				</center>
			</h:panelGrid>
		</h:form>
	</rich:modalPanel>
</body>
</html>