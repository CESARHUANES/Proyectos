<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:a4j="http://richfaces.org/a4j" 
	xmlns:rich="http://richfaces.org/rich" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets" >
	
	<a4j:keepAlive beanName="buscarLoteController" />
	
	<head>
		<script type="text/javascript" src="#{facesContext.externalContext.requestContextPath}/js/validacion.js" />
		<style type="text/css">
			.infoCabecera {
				width: 100%;
				margin: auto;
				border: 0;
				padding-bottom: 30px;
			}
			
			.labelCabecera {
				float: right;
				font-weight: bold;
				font-size: 12px;
			}
			
			.botonInferior {
				float: right;
				padding-top: 10px;
			}
		</style>
	</head>
	<body>
		<div style="padding-top: 20px;">
			<h:form id="formBuscarLoteStep2_A">
				<table class="infoCabecera">
					<tr>
						<td style="text-align: right; width: 8%;">
							<h:outputText value="Nro. Lote: " styleClass="labelCabecera" />
						</td>
						<td style="text-align: right; width: 12%;">
							<h:outputText id="numLoteGenerado" value="#{buscarLoteController.nroLoteFormateado}" styleClass="labelCabecera" />
						</td>
						<td style="text-align: right; width: 75%;">

				   			<h:commandButton action="#{buscarLoteController.descargarPDFLoteImpresion}" value="Descargar PDF">
								<!-- <f:param value="#{buscarLoteController.nroLoteAux}" name="opcionDI" /> -->				   	
							</h:commandButton> 
							
						</td>
					</tr>
					<tr>
						<td colspan="3">
							<div class="separatorLine" />
						</td>
					</tr>
				</table>
			</h:form>
			
			<h:form id="formBuscarLoteStep2_B">
				<rich:panel id="pnlListaConfirmacion">
					<div class="extendedDTableContenido">				
						<rich:extendedDataTable id="listaConfirmacionImpresion" var="itemConfImpresion" value="#{buscarLoteController.listaConfirmacionImpresion}"
							width="1018px" height="335px" selectionMode="single">
							<rich:column headerClass="dataTableHeader" width="12%" sortable="true" sortBy="#{itemConfImpresion.nroPolizaPe}"
								sortIconAscending="dataTableAscIcon" sortIconDescending="dataTableDescIcon" style="#{itemConfImpresion.validatedCSSStyle};">
								<f:facet name="header">
									<h:outputText value="Nª Póliza" />
								</f:facet>
								<center>
									<h:outputText value="#{itemConfImpresion.nroPolizaPe}" />
								</center>
							</rich:column>
							<rich:column id="placa1" headerClass="dataTableHeader" width="12%" sortable="true" sortBy="#{itemConfImpresion.placa}"
								sortIconAscending="dataTableAscIcon" sortIconDescending="dataTableDescIcon" style="#{itemConfImpresion.validatedCSSStyle};">
								<f:facet name="header">
									<h:outputText value="Placa" />
								</f:facet>
								<center>
									<h:outputText value="#{itemConfImpresion.placa}" />
								</center>
							</rich:column>
							<rich:column headerClass="dataTableHeader" width="18%" sortable="true" sortBy="#{itemConfImpresion.fecIniVigencia}"
								sortIconAscending="dataTableAscIcon" sortIconDescending="dataTableDescIcon" style="#{itemConfImpresion.validatedCSSStyle};">
								<f:facet name="header">
									<h:outputText value="Fec. Inicio Vigencia" />
								</f:facet>
								<center>
									<h:outputText value="#{itemConfImpresion.fecIniVigencia}">
										<f:convertDateTime pattern="yyyy-MM-dd"/>
									</h:outputText>
								</center>
							</rich:column>
							<rich:column headerClass="dataTableHeader" width="18%" sortable="true" sortBy="#{itemConfImpresion.fecFinVigencia}"
								sortIconAscending="dataTableAscIcon" sortIconDescending="dataTableDescIcon" style="#{itemConfImpresion.validatedCSSStyle};">
								<f:facet name="header">
									<h:outputText value="Fec. Fin Vigencia" />
								</f:facet>
								<center>
									<h:outputText value="#{itemConfImpresion.fecFinVigencia}">
										<f:convertDateTime pattern="yyyy-MM-dd"/>
									</h:outputText>
								</center>
							</rich:column>	
							<rich:column headerClass="dataTableHeader" width="24%" sortable="false" style="#{itemConfImpresion.validatedCSSStyle};">
								<f:facet name="header">
									<h:outputText value="Impreso Correctamente?" />
								</f:facet>
								<center>
									<h:selectOneRadio id="radioHabilitar" 
													  value="#{itemConfImpresion.impresoCorrectamente}" 											
													  valueChangeListener="#{buscarLoteController.habilitarTxtNroCertificado}" >
													  
   										<f:selectItem itemValue="SI #{itemConfImpresion.id}" itemLabel="SI" />
   										<f:selectItem itemValue="REEMPLAZAR #{itemConfImpresion.id}" itemLabel="REEMPLAZAR" />
   										<a4j:support event="onchange" reRender="listaConfirmacionImpresion" ajaxSingle="true"/>
   										
									</h:selectOneRadio>
								</center>
							</rich:column>
							<rich:column headerClass="dataTableHeader" width="18%" sortable="true" style="#{itemConfImpresion.validatedCSSStyle};">
								<f:facet name="header">
									<h:outputText value="Nª Certificado" />
								</f:facet>
								<center>
									<h:inputText id="txtNroCertificado" disabled="#{itemConfImpresion.disabledText}" 
												 value="#{itemConfImpresion.nroCertificado}" 
												 maxlength="14" 
												 style="width:120px;" 
												 onkeypress="return valNumeros(event)">
										
																																				
									</h:inputText>
								</center>
							</rich:column>
						</rich:extendedDataTable>			
					</div>		
				</rich:panel>
				<span class="botonInferior">
				   <a4j:commandButton action="#{buscarLoteController.guardarLoteImpresion}" onclick="this.disabled=true;" value="Guardar" 
						oncomplete="#{null == facesContext.maximumSeverity ? 'Richfaces.showModalPanel(\'panelBuscarLoteConfirmacionExitosa\');this.disabled=false' : 'this.disabled=false;'}"
						reRender="panelBuscarLoteConfirmacionExitosa" render="true" /> 	
					<a4j:commandButton value="Regresar" action="#{buscarLoteController.Volver}" render="true" reRender="panelStep1, panelStep2, tituloCabecera, reiniciar" >
					
					</a4j:commandButton>
	
				</span>
			</h:form>
		</div>
		
		<rich:modalPanel id="panelBuscarLoteConfirmacionExitosa" width="250" height="130">
			<f:facet name="header">
				<h:outputText value="Mensaje" />
			</f:facet>
			<h:form id="formConfirmacionExitosa">
				<h:panelGroup>
					<center>
						<h5>
							<h:outputText value="El Lote fue guardado correctamente." />
						</h5>
						<h:commandButton value="Aceptar" onclick="#{rich:component('panelBuscarLoteConfirmacionExitosa')}.hide(); #{rich:component('formBuscarLoteStep2_A')}.hide(); return false" 
							oncomplete="#{facesContext.maximumSeverity == null ? 'Richfaces.hideModalPanel(\'formBuscarLoteStep2_A\')' : ';'}" action="#{buscarLoteController.reiniciarPantallaInicial}"
							reRender="panelPrincipal" />
					</center>
				</h:panelGroup>
			</h:form>
		</rich:modalPanel>
	</body>
</html>